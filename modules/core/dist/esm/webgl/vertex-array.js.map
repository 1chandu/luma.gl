{"version":3,"sources":["../../../src/webgl/vertex-array.js"],"names":["Accessor","Buffer","VertexArrayObject","log","assert","stubRemovedMethods","ERR_ATTRIBUTE_TYPE","VertexArray","gl","opts","id","program","configuration","elements","values","accessors","unused","drawParams","buffer","vertexArrayObject","isSupported","getDefaultArray","initialize","Object","seal","delete","props","reset","bindOnUse","setProps","MAX_ATTRIBUTES","Array","fill","setAttributes","attributes","setElementBuffer","appParameters","_updateDrawParams","assign","_updateAttributeZeroBuffer","bind","locationOrName","value","setBuffer","isArray","length","accessor","ArrayBuffer","isView","setConstant","Error","bindBuffer","elementBuffer","clearDrawParams","isDefaultArray","appAccessor","target","_resolveLocationAndAccessor","location","arrayValue","_normalizeConstantArrayValue","enable","size","disableVertexAttribArray","handle","vertexAttribPointer","vertexCount","func","_setConstantAttributes","hasVertexArrays","bindBuffers","unbindBuffers","valueAccessor","_getAttributeIndex","Number","isFinite","once","accessInfo","_getAttributeInfo","resolve","type","attributeName","getAttributeInfo","getAttributeLocation","constant","_setConstantAttributeZero","_setConstantAttribute","constantAttributeZero","getConstantBuffer","isDefault","instanceCount","elementCount","Math","max","isIndexed","isInstanced","indexCount","Infinity","_updateDrawParamsForLocation","getElementCount","indexType","divisor","getVertexCount","min","deprecated"],"mappings":"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","sourcesContent":["// VertexArray class\n\nimport GL from '../constants';\nimport Accessor from './accessor';\nimport Buffer from './buffer';\nimport VertexArrayObject from './vertex-array-object';\nimport {log, assert} from '../utils';\nimport {stubRemovedMethods} from '../utils';\n\nconst ERR_ATTRIBUTE_TYPE =\n  'VertexArray: attributes must be Buffers or constants (i.e. typed array)';\n\nexport default class VertexArray {\n  constructor(gl, opts = {}) {\n    // Use program's id if program is supplied but no id is supplied\n    const id = opts.id || opts.program && opts.program.id;\n    // super(gl, Object.assign({}, opts, {id}));\n\n    this.id = id;\n    this.gl = gl;\n    this.configuration = null;\n\n    // Extracted information\n    this.elements = null;\n    this.values = null;\n    this.accessors = null;\n    this.unused = null;\n    this.drawParams = null;\n    this.buffer = null; // For attribute 0 on desktops, and created when unbinding buffers\n\n    this.vertexArrayObject = VertexArrayObject.isSupported(gl) ?\n      new VertexArrayObject(gl) :\n      VertexArrayObject.getDefaultArray(gl);\n\n    // Issue errors when using removed methods\n    stubRemovedMethods(this, 'VertexArray', 'v6.0', [\n      'setBuffers', 'setGeneric', 'clearBindings', 'setLocations', 'setGenericValues',\n      'setDivisor', 'enable', 'disable'\n    ]);\n\n    this.initialize(opts);\n    Object.seal(this);\n  }\n\n  delete() {\n    if (this.buffer) {\n      this.buffer.delete();\n    }\n  }\n\n  initialize(props = {}) {\n    this.reset();\n    this.configuration = null;\n    this.bindOnUse = false;\n    return this.setProps(props);\n  }\n\n  // Resets all attributes (to default valued constants)\n  reset() {\n    // this.vertexArrayObject.reset();\n\n    this.elements = null;\n    const {MAX_ATTRIBUTES} = this.vertexArrayObject;\n    this.values = new Array(MAX_ATTRIBUTES).fill(null);\n    this.accessors = new Array(MAX_ATTRIBUTES).fill(null);\n    this.unused = {};\n\n    // Auto detects draw params\n    this.drawParams = null;\n\n    return this;\n  }\n\n  setProps(props) {\n    if ('program' in props) {\n      this.configuration = props.program && props.program.configuration;\n    }\n    if ('configuration' in props) {\n      this.configuration = props.configuration;\n    }\n    if ('attributes' in props) {\n      this.setAttributes(props.attributes);\n    }\n    if ('elements' in props) {\n      this.setElementBuffer(props.elements);\n    }\n    if ('bindOnUse' in props) {\n      props = props.bindOnUse;\n    }\n    return this;\n  }\n\n  // Automatically called if buffers changed through VertexArray API\n  clearDrawParams() {\n    this.drawParams = null;\n  }\n\n  getDrawParams(appParameters) {\n    // Auto deduced draw parameters\n    this.drawParams = this.drawParams || this._updateDrawParams();\n\n    // Override with any application supplied draw parameters\n    const drawParams = Object.assign({}, this.drawParams, appParameters);\n\n    this._updateAttributeZeroBuffer(drawParams);\n    return drawParams;\n  }\n\n  // Set (bind) an array or map of vertex array buffers, either in numbered or named locations.\n  // For names that are not present in `location`, the supplied buffers will be ignored.\n  // if a single buffer of type GL.ELEMENT_ARRAY_BUFFER is present, it will be set as elements\n  //   Signatures:\n  //     {attributeName: buffer}\n  //     {attributeName: [buffer, accessor]}\n  //     {attributeName: (typed) array} => constant\n  setAttributes(attributes) {\n    this.vertexArrayObject.bind(() => {\n      for (const locationOrName in attributes) {\n        const value = attributes[locationOrName];\n        if (value instanceof Buffer) {\n          //  Signature: attributeName: buffer\n          this.setBuffer(locationOrName, value);\n        } else if (Array.isArray(value) && value.length && value[0] instanceof Buffer) {\n          // Signature: attributeName: [buffer, accessor]\n          const buffer = value[0];\n          const accessor = value[1];\n          this.setBuffer(locationOrName, buffer, accessor);\n        } else if (ArrayBuffer.isView(value) || Array.isArray(value)) {\n          //  Signature: attributeName: (short) (typed) array => constant\n          this.setConstant(locationOrName, value);\n        } else {\n          throw new Error(ERR_ATTRIBUTE_TYPE);\n        }\n      }\n\n      // Make sure we don't leave any bindings\n      this.gl.bindBuffer(GL.ARRAY_BUFFER, null);\n    });\n\n    return this;\n  }\n\n  // Set (bind) an elements buffer, for indexed rendering.\n  // Must be a Buffer bound to GL.ELEMENT_ARRAY_BUFFER. Constants not supported\n  setElementBuffer(elementBuffer = null, accessor = {}) {\n    this.elements = elementBuffer; // Save value for debugging\n    this.clearDrawParams();\n\n    // Update vertexArray immediately if we have our own array\n    if (!this.vertexArrayObject.isDefaultArray) {\n      this.vertexArrayObject.setElementBuffer(elementBuffer, accessor);\n    }\n    return this;\n  }\n\n  // Set a location in vertex attributes array to a buffer\n  setBuffer(locationOrName, buffer, appAccessor = {}) {\n    // Check target\n    if (buffer.target === GL.ELEMENT_ARRAY_BUFFER) {\n      return this.setElementBuffer(buffer);\n    }\n\n    const {location, accessor} =\n      this._resolveLocationAndAccessor(locationOrName, buffer, buffer.accessor, appAccessor);\n\n    if (location >= 0) {\n      this.values[location] = buffer;\n      this.accessors[location] = accessor;\n      this.clearDrawParams();\n\n      // Update vertexArray immediately if we have our own array\n      if (!this.vertexArrayObject.isDefaultArray) {\n        this.vertexArrayObject.setBuffer(location, buffer, accessor);\n      }\n    }\n\n    return this;\n  }\n\n  // Set attribute to constant value (small typed array corresponding to one vertex' worth of data)\n  setConstant(locationOrName, arrayValue, appAccessor = {}) {\n    const {location, accessor} =\n      this._resolveLocationAndAccessor(locationOrName, arrayValue, appAccessor);\n\n    if (location >= 0) {\n      arrayValue = this.vertexArrayObject._normalizeConstantArrayValue(arrayValue, accessor);\n\n      this.values[location] = arrayValue;\n      this.accessors[location] = accessor;\n      this.clearDrawParams();\n\n      // Update vertexArray immediately if we have our own array\n      // NOTE: We set the actual constant value later on bind. We can't set the value now since\n      // constants are global and affect all other VertexArrays that have disabled attributes\n      // in the same location.\n      // We do disable the attribute which makes it use the global constant value at that location\n      if (!this.vertexArrayObject.isDefaultArray) {\n        this.vertexArrayObject.enable(location, false);\n      }\n    }\n\n    return this;\n  }\n\n  // Workaround for Chrome TransformFeedback binding issue\n  // If required, unbind temporarily to avoid conflicting with TransformFeedback\n  unbindBuffers() {\n    this.vertexArrayObject.bind(() => {\n      if (this.elements) {\n        this.setElementBuffer(null);\n      }\n\n      // Chrome does not like buffers that are bound to several binding points,\n      // so we need to offer and unbind facility\n      // WebGL offers disabling, but no clear way to set a VertexArray buffer to `null`\n      // So we just bind all the attributes to the dummy \"attribute zero\" buffer\n      this.buffer = this.buffer || new Buffer(this.gl, {size: 4});\n\n      for (let location = 0; location < this.vertexArrayObject.MAX_ATTRIBUTES; location++) {\n        if (this.values[location] instanceof Buffer) {\n          this.gl.disableVertexAttribArray(location);\n          this.gl.bindBuffer(GL.ARRAY_BUFFER, this.buffer.handle);\n          this.gl.vertexAttribPointer(location, 1, GL.FLOAT, false, 0, 0);\n        }\n      }\n    });\n    return this;\n  }\n\n  // Workaround for Chrome TransformFeedback binding issue\n  // If required, rebind rebind after temporary unbind\n  bindBuffers() {\n    this.vertexArrayObject.bind(() => {\n      if (this.elements) {\n        this.setElementBuffer(this.elements);\n      }\n\n      for (let location = 0; location < this.vertexArrayObject.MAX_ATTRIBUTES; location++) {\n        const buffer = this.values[location];\n        if (buffer instanceof Buffer) {\n          this.setBuffer(location, buffer);\n        }\n      }\n    });\n    return this;\n  }\n\n  // Bind for use\n  // When a vertex array is about to be used, we must:\n  // - Set constant attributes (since these are stored on the context and reset on bind)\n  // - Check if we need to initialize the buffer\n  bindForDraw(vertexCount, func) {\n    let value;\n\n    this.vertexArrayObject.bind(() => {\n\n      // Make sure that any constant attributes are updated (stored on the context, not the VAO)\n      // Also handles attribute 0\n      this._setConstantAttributes(vertexCount);\n\n      if (!this.vertexArrayObject.hasVertexArrays) {\n        this.bindBuffers();\n      }\n\n      value = func();\n\n      if (!this.vertexArrayObject.hasVertexArrays) {\n        this.unbindBuffers();\n      }\n\n    });\n\n    return value;\n  }\n\n  // PRIVATE\n\n  // Resolve locations and accessors\n  _resolveLocationAndAccessor(locationOrName, value, valueAccessor, appAccessor) {\n    const location = this._getAttributeIndex(locationOrName);\n    if (!Number.isFinite(location) || location < 0) {\n      this.unused[locationOrName] = value;\n      log.once(3, () => `unused value ${locationOrName} in ${this.id}`)();\n      return this;\n    }\n\n    const accessInfo = this._getAttributeInfo(locationOrName);\n\n    // Resolve the partial accessors into a final accessor\n    const accessor = Accessor.resolve(accessInfo.accessor, valueAccessor, appAccessor);\n\n    const {size, type} = accessor;\n    assert(Number.isFinite(size) && Number.isFinite(type));\n\n    return {location, accessor};\n  }\n\n  _getAttributeInfo(attributeName) {\n    return this.configuration && this.configuration.getAttributeInfo(attributeName);\n  }\n\n  _getAttributeIndex(locationOrName) {\n    if (this.configuration) {\n      return this.configuration.getAttributeLocation(locationOrName);\n    }\n    const location = Number(locationOrName);\n    if (Number.isFinite(location)) {\n      return location;\n    }\n    return -1;\n  }\n\n  // Updates all constant attribute values (constants are used when vertex attributes are disabled).\n  // This needs to be done repeatedly since in contrast to buffer bindings,\n  // constants are stored on the WebGL context, not the VAO\n  _setConstantAttributes(vertexCount) {\n    let constant = this.values[0];\n    if (ArrayBuffer.isView(constant)) {\n      this._setConstantAttributeZero(constant, vertexCount);\n    }\n\n    for (let location = 1; location < this.vertexArrayObject.MAX_ATTRIBUTES; location++) {\n      constant = this.values[location];\n      if (ArrayBuffer.isView(constant)) {\n        this._setConstantAttribute(location, constant);\n      }\n    }\n  }\n\n  _setConstantAttributeZero(constant, vertexCount) {\n    if (VertexArrayObject.isSupported(this.gl, {constantAttributeZero: true})) {\n      this._setConstantAttribute(0, constant);\n      return;\n    }\n\n    // Get a dummy buffer populated with repeated constants\n    const buffer = this.vertexArrayObject.getConstantBuffer(vertexCount);\n\n    // Set the buffer on location 0\n    this.vertexArrayObject.setBuffer(0, buffer, this.accessors[0]);\n  }\n\n  _setConstantAttribute(location, constant) {\n    VertexArrayObject.setConstant(this.gl, location, constant);\n\n    // If we are using the global VertexArrayObject, we need to disable the attribute now\n    if (this.vertexArrayObject.isDefault) {\n      this.vertexArrayObject.enable(location, false);\n    }\n  }\n\n  // NOTE: Desktop OpenGL cannot disable attribute 0\n  // https://stackoverflow.com/questions/20305231/webgl-warning-attribute-0-is-disabled-\n  // this-has-significant-performance-penalt\n  _updateAttributeZeroBuffer({vertexCount, instanceCount}) {\n    // TODO - Determine required length\n    const elementCount = Math.max(vertexCount | 0, instanceCount | 0);\n\n    // Create buffer only when needed, and reuse it (avoids inflating buffer creation statistics)\n    const constant = this.values[0];\n    if (ArrayBuffer.isView(constant)) {\n      const size = elementCount;\n      this.buffer = this.buffer || new Buffer(this.gl, {size});\n    }\n  }\n\n  // Walks the buffers and updates draw parameters\n  _updateDrawParams() {\n    const drawParams = {\n      isIndexed: false,\n      isInstanced: false,\n      indexCount: Infinity,\n      vertexCount: Infinity,\n      instanceCount: Infinity\n    };\n\n    for (let location = 0; location < this.vertexArrayObject.MAX_ATTRIBUTES; location++) {\n      this._updateDrawParamsForLocation(drawParams, location);\n    }\n\n    if (this.elements) {\n      // indexing is autodetected - buffer with target GL.ELEMENT_ARRAY_BUFFER\n      // index type is saved for drawElement calls\n      drawParams.elementCount = this.elements.getElementCount(this.elements.accessor);\n      drawParams.isIndexed = true;\n      drawParams.indexType = this.elements.accessor.type;\n    }\n\n    // Post-calculation checks\n    if (drawParams.indexCount === Infinity) {\n      drawParams.indexCount = 0;\n    }\n    if (drawParams.vertexCount === Infinity) {\n      drawParams.vertexCount = 0;\n    }\n    if (drawParams.instanceCount === Infinity) {\n      drawParams.instanceCount = 0;\n    }\n\n    return drawParams;\n  }\n\n  _updateDrawParamsForLocation(drawParams, location) {\n    const value = this.values[location];\n    const accessor = this.accessors[location];\n\n    if (!value) {\n      return;\n    }\n\n    // Check if instanced (whether buffer or constant)\n    const {divisor} = accessor;\n    const isInstanced = divisor > 0;\n    drawParams.isInstanced = drawParams.isInstanced || isInstanced;\n\n    if (value instanceof Buffer) {\n      const buffer = value;\n\n      if (isInstanced) {\n        // instance attribute\n        const instanceCount = buffer.getVertexCount(accessor);\n        drawParams.instanceCount = Math.min(drawParams.instanceCount, instanceCount);\n      } else {\n        // normal attribute\n        const vertexCount = buffer.getVertexCount(accessor);\n        drawParams.vertexCount = Math.min(drawParams.vertexCount, vertexCount);\n      }\n    }\n  }\n\n  // DEPRECATED\n\n  setElements(elementBuffer = null, accessor = {}) {\n    log.deprecated('setElements', 'setElementBuffer');\n    return this.setElementBuffer(elementBuffer, accessor);\n  }\n}\n"],"file":"vertex-array.js"}